using System;
using System.Net.Http;
using System.Threading.Tasks;
using Newtonsoft.Json.Linq;

class Program
{
    static async Task Main()
    {
        string owner = "Malvine254";
        string repo = "directoryFileListing";
        string apiBaseUrl = "https://api.github.com/repos/";

        string apiUrl = $"{apiBaseUrl}{owner}/{repo}/contents/services";

        try
        {
            using (HttpClient client = new HttpClient())
            {
                // Set the User-Agent header as required by GitHub API
                client.DefaultRequestHeaders.Add("User-Agent", "YourAppName");

                // Make a GET request to the GitHub API
                HttpResponseMessage response = await client.GetAsync(apiUrl);

                if (response.IsSuccessStatusCode)
                {
                    // Read the response content
                    string jsonResponse = await response.Content.ReadAsStringAsync();

                    // Parse the JSON response
                    JArray files = JArray.Parse(jsonResponse);

                    Console.WriteLine("Files in the GitHub repository:");

                    foreach (var file in files)
                    {
                        string fileName = file["name"].ToString();
                        string finalFileName = System.IO.Path.GetFileName(fileName);
                        Console.WriteLine(fileName);
                         using (System.IO.FileStream fs = System.IO.File.Create(finalFileName))
                    {
                        await response.Content.CopyToAsync(fs);
                        Console.WriteLine($"File '{finalFileName}' downloaded successfully.");
                    }
                    }
                }
                else
                {
                    Console.WriteLine($"Error: {response.StatusCode} - {response.ReasonPhrase}");
                }
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"An error occurred: {ex.Message}");
        }

        Console.ReadLine(); // Pause to see the results (optional)
    }
}
